<style>
  #postlist{
    max-width:800px;
    margin:0 auto;
    padding:10px;
  }

  .post-item{
    background:#fff;
    padding:15px;
    margin-bottom:12px;
    border-radius:8px;
    box-shadow:0 2px 6px rgba(0,0,0,0.05);
  }

  .post-item h3{
    margin:0 0 8px;
    font-size:18px;
  }

  .post-item a{
    text-decoration:none;
    color:#222;
  }

  .post-item a:hover{
    text-decoration:underline;
  }

  .post-item p{
    margin:0;
    color:#555;
    font-size:14px;
    line-height:1.5;
  }

  /* ===== Skeleton (FB style) ===== */
  .skeleton{
    background:#fff;
    padding:15px;
    margin-bottom:12px;
    border-radius:8px;
  }

  .sk-line{
    height:12px;
    margin-bottom:10px;
    border-radius:6px;
    background:linear-gradient(
      90deg,#eee 25%,#f5f5f5 37%,#eee 63%
    );
    background-size:400% 100%;
    animation:shimmer 1.4s infinite;
  }

  .sk-title{ height:16px; width:60%; }
  .sk-text{ width:100%; }

  @keyframes shimmer{
    0%{background-position:100% 0}
    100%{background-position:0 0}
  }

  /* Empty state */
  .empty{
    text-align:center;
    padding:20px;
    color:#777;
  }

  @media (max-width:480px){
    .post-item h3{ font-size:16px; }
    .post-item p{ font-size:13px; }
  }
</style>

<div id="postlist"></div>

<!-- sentinel for observer -->
<div id="sentinel"></div>
<a href="#top">Go to top</a>
<script>
const postlist = document.getElementById("postlist");
const sentinel = document.getElementById("sentinel");

let cursor = null;
let loading = false;
let hasMore = true;
let canLoad = false;   // üîí splash gate

/* ===== Skeleton ===== */
function showSkeleton(){
  for(let i=0;i<9;i++){
    const sk = document.createElement("div");
    sk.className = "skeleton";
    sk.innerHTML = `
      <div class="sk-line sk-title"></div>
      <div class="sk-line sk-text"></div>
      <div class="sk-line sk-text"></div>
    `;
    postlist.appendChild(sk);
  }
}

function removeSkeleton(){
  document.querySelectorAll(".skeleton").forEach(s=>s.remove());
}

/* ===== Fetch posts ===== */
async function loadPosts(){
  if(!canLoad || loading || !hasMore) return;

  loading = true;
  showSkeleton();

  try{
    const url = cursor
      ? `/admin/data?after=${cursor}`
      : `/admin/data`;

    const res = await fetch(url);
    const data = await res.json();

    removeSkeleton();

    if(!data.posts.length){
      hasMore = false;
      sentinel.innerHTML = `<div class="empty">‡¶Ü‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</div>`;
      return;
    }

    data.posts.forEach(post=>{
      const div = document.createElement("div");
      div.className = "post-item";
      div.innerHTML = `
        <h3>
          <a href="/post/${post.id}">
            ${post.title}
          </a>
        </h3>
        <p>${post.id}</p>
      `;
      postlist.appendChild(div);
    });

    cursor = data.nextCursor;

  }catch(err){
    console.error(err);
  }finally{
    loading = false;
  }
}

/* ===== Observer ===== */
const observer = new IntersectionObserver(entries=>{
  if(entries[0].isIntersecting){
    loadPosts();
  }
},{
  rootMargin:"150px"
});

observer.observe(sentinel);

/* ===== Splash finished ===== */
window.addEventListener("splashFinished", () => {
  
  canLoad = true;
  loadPosts();   // üöÄ first load
});

showSkeleton();

/* ===== Fallback: no splash ===== */
/*document.addEventListener("DOMContentLoaded", () => {
  if(!document.getElementById("splash")){
    canLoad = true;
    loadPosts();
  }
});*/
</script>